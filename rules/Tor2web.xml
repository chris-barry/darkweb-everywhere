<!-- 
This ruleset ensures that Tor Browser Bundle users don't accidentally use a Tor2web node.       
Wanted to include <target host="*.onion.to" /> but it wouldn't work due to a bug associated with the keyword "to".
Need to add Tor2web to the downgrade whitelist
-->

<ruleset name="Tor2web">
  <target host="*.tor2web.com" />
  <target host="*.tor2web.org" />

  <target host="*.onion.cab" />
  <target host="*.onion.city" />  
  <target host="*.onion.direct" />  
  <target host="*.onion.link" /> 
  <target host="*.onion.nu" />


  <test url="https://thundersplv36ecb.tor2web.com/" />
  <test url="https://deepdot35wvmeyd5.tor2web.com/" />
  <test url="https://thundersplv36ecb.tor2web.org/" />
  <test url="https://dirre2hfssh2offv.tor2web.org/" />
  
  <test url="http://thundersplv36ecb.onion.link/" />
  <test url="http://32rfckwuorlf4dlv.onion.link/" />
  <test url="https://dirre2hfssh2offv.onion.link/" />
  <test url="https://torlinkbgs6aabns.onion.link/" />
  <test url="https://deepdot35wvmeyd5.onion.link/" />

  <rule from="^(http|https)://([a-z0-9\.]*[a-z0-9]{16})\.onion\.(cab|city|direct|link|nu)/" to="http://$2.onion/" downgrade="1" />
  <rule from="^(http|https)://([a-z0-9\.]*[a-z0-9]{16})\.tor2web\.(com|org)/" to="http://$2.onion/" downgrade="1" />
</ruleset>
